## 功能模块介绍：

1、main.lua：主程序入口,以下三个脚本按自己的需求选择其一使用即可，另外两个注释；

2、wan.lua：以太网提供网络供模组上网；

3、lan.lua：模组连接4G网络通过以太网口传输给其他设备供网；

4、netif_app: 网络管理模块，开启多网融合功能，以太网提供网络供wifi和以太网设备上网；

## 演示功能概述

1、模组连接4G网络通过以太网口传输给其他设备供网 

## 演示硬件环境

1、Air8000核心板一块+可上网的sim卡一张+网线一根+AirETH_1000板子一个;

[](https://docs.openluat.com/air8000/luatos/app/image/lan.jpg)

![lan](E:\文档池\新建文件夹\luatos-doc-pool\docs\root\docs\air8000\luatos\app\image\lan.jpg)

2、TYPE-C USB数据线一根 + 杜邦线若干;

* Air8000核心板通过TYPE-C USB口供电；（外部供电/USB供电 拨动开关 拨到 USB供电一端）

* TYPE-C USB数据线直接插到核心板的TYPE-C USB座子，另外一端连接电脑USB口；

* AirETH_1000板子网口与电脑网口通过网线连接；

3、Air8000核心板和AirETH_1000配件板的硬件接线方式为：

| Air8000核心板 | AirETH_1000配件板 |
| ---------- | -------------- |
| vdd        | 3.3v           |
| gnd        | gnd            |
| spi1_sclk  | SCK            |
| spi1_cs    | CSS            |
| spi1_miso  | SDO            |
| spi1_mosi  | SDI            |
| gpio21     | INT            |

演示软件环境
------

1、Luatools下载调试工具

2、[Air8000 V2014版本固件](https://docs.openluat.com/air8000/luatos/firmware/)（理论上，2025年9月12日之后发布的固件都可以） 

## 演示核心步骤

1、搭建好硬件环境，按接线图连接硬件。

2、烧录内核固件和本项目的Lua脚本：main.lua：主程序入口(需要在main.lua文件中打开require"lan")，lan.lua：模组连接4G网络通过以太网口传输给其他设备供网。

3、启动设备，观察日志输出：

```
[2025-09-12 15:25:44.453][000000006.933] D/ch390h 注册CH390H设备 SPI id 1 cs 12 irq 255

[2025-09-12 15:25:44.512][000000006.934] D/netdrv.ch390x task started

[2025-09-12 15:25:44.560][000000006.934] D/ch390h ch390注册完成

[2025-09-12 15:25:44.595][000000006.979] D/netdrv.ch390x 初始化MAC 701988D3008A

[2025-09-12 15:25:44.627][000000006.980] D/netdrv.ch390x luat_netif_init 执行完成 1

[2025-09-12 15:25:45.993][000000008.574] I/netdrv.ch390x link is up 1 12 100M

[2025-09-12 15:25:46.850][000000009.435] I/user.lua 4194296 54592 54592

[2025-09-12 15:25:46.880][000000009.435] I/user.sys 3208824 303680 305200

[2025-09-12 15:25:47.349][000000009.935] D/net network ready 4, setup dns server

[2025-09-12 15:25:47.445][000000009.935] I/user.ipv4 192.168.4.1 255.255.255.0 192.168.4.1

[2025-09-12 15:25:49.356][000000011.936] I/user.dhcpsrv 自动获取网卡IP作为网关 192.168.4.1

[2025-09-12 15:25:49.399][000000011.937] D/socket connect to 255.255.255.255,0

[2025-09-12 15:25:49.451][000000011.937] D/net connect 255.255.255.255:0 UDP

[2025-09-12 15:25:49.482][000000011.939] I/user.dnsproxy 4 1

[2025-09-12 15:25:49.525][000000011.941] I/user.dnsproxy 开始监听

[2025-09-12 15:25:49.568][000000011.944] D/socket connect to 255.255.255.255,0

[2025-09-12 15:25:49.612][000000011.945] D/net connect 255.255.255.255:0 UDP

[2025-09-12 15:25:49.655][000000011.946] D/socket connect to 119.29.29.29,53

[2025-09-12 15:25:49.699][000000011.946] D/netdrv NAPT is enabled gw 1

[2025-09-12 15:25:49.751][000000011.951] I/user.启动iperf服务器端

[2025-09-12 15:25:49.794][000000011.952] D/iperf 启动iperf server 0

[2025-09-12 15:25:49.825][000000011.952] D/lwiperf iperf_malloc 88 88 0xc1703c4

[2025-09-12 15:25:49.852][000000011.952] D/iperf iperf listen 192.168.4.1:5001

[2025-09-12 15:25:49.878][000000012.436] I/user.lua 4194296 58552 58568

[2025-09-12 15:25:49.908][000000012.436] I/user.sys 3208824 512576 514616

[2025-09-12 15:25:50.690][000000013.275] I/user.dhcpsrv 是discover包 E466E52E5EE6 12

[2025-09-12 15:25:50.720][000000013.276] I/user.dhcpsrv 分配ip E466E52E5EE6 192.168.4.100

[2025-09-12 15:25:50.755][000000013.276] I/user.dhcpsrv send offer

[2025-09-12 15:25:50.791][000000013.289] I/user.dhcpsrv 是request包 E466E52E5EE6 12

[2025-09-12 15:25:50.828][000000013.289] I/user.dhcpsrv request,发现已经分配的mac地址, send ack E466E52E5EE6 12

[2025-09-12 15:25:52.852][000000015.437] I/user.lua 4194296 69128 69944

[2025-09-12 15:25:52.883][000000015.437] I/user.sys 3208824 514232 515760

```

4、电脑通过网线与AirETH_1000板子连接若可以正常上网，则表示验证成功。
