## 演示功能概述

### 1.1 HTTPSVR 文件管理系统概述

HTTPSVR 文件管理系统是一种基于Air8000模组的轻量级文件服务器解决方案，通过AP创建WiFi热点并提供HTTP服务，使用户可以通过浏览器方便地浏览、管理和下载设备内部存储及SD卡中的文件。

### 1.2 系统工作原理

设备启动后，按下boot按键，自动创建AP热点，并初始化SD卡挂载。同时启动HTTP服务器，提供文件列表浏览、文件下载等功能。用户只需连接到设备的WiFi热点，通过浏览器访问指定IP地址，即可查看和管理设备中的文件。

### 1.3 核心功能特性

- **AP热点创建**：设备自动创建名为`Air8000_FileHub`的WiFi热点，供用户连接
- **SD卡管理**：自动挂载SD卡，支持浏览和下载SD卡中的文件
- **文件浏览**：通过浏览器查看设备内部存储和SD卡中的文件列表
- **文件下载**：支持直接通过URL下载文件，支持大文件下载
- **用户认证**：提供简单的用户名密码认证机制，保护文件安全

本示例基于合宙 Air8000 模组，演示 **AP + 文件服务器** 的完整实现流程。用户连接到设备WiFi热点后，通过浏览器即可访问文件管理系统，实现文件的浏览和下载功能。

#### 1、初始化AP热点

调用 `exnetif.setproxy()` 创建AP热点，配置热点名称、密码及网络参数。

#### 2、SD卡初始化与挂载

- 配置SPI接口，初始化SD卡
- 将SD卡挂载到文件系统，挂载点为`/sd`
- 检测SD卡可用空间，列出根目录文件

#### 3、启动HTTP服务器

- 配置服务器端口为80
- 注册请求处理函数
- 实现文件列表、文件下载等API
- 支持直接文件URL访问

#### 4、文件访问路径映射

- 访问普通文件（如 `http://192.168.4.1/456.txt`）映射到内部存储 `/luadb/456.txt`
- 访问SD卡文件（如 `http://192.168.4.1/sd/readme.md`）映射到SD卡路径 `/sd/readme.md`

#### 5、安全认证机制

- 默认用户名：admin
- 默认密码：123456
- 支持通过Cookie保持会话
- 支持通过URL参数进行一次性认证

#### 6、运行效果

- **WiFi创建成功**：手机/电脑可搜索到`Air8000_FileHub`热点
- **服务器启动成功**：连接热点后访问`http://192.168.4.1`可进入文件管理界面
- **文件浏览**：可查看设备内部存储和SD卡中的文件列表
- **文件下载**：点击文件或通过直接URL可下载文件到本地

#### 7、快速上手

1. 烧录固件后上电，设备自动创建WiFi热点并启动文件服务器
2. 使用手机或电脑连接到`Air8000_FileHub`热点（密码：12345678）
3. 打开浏览器，输入`http://192.168.4.1`访问文件管理系统
4. 使用用户名`admin`和密码`123456`登录
5. 浏览文件列表，点击文件可直接下载

## 演示硬件环境

1、Air8000核心板/开发板一块

2、配套天线一套

3、TYPE-C USB数据线一根

4、micro SD卡一张（可选，用于扩展存储）

## 演示软件环境

1、Luatools下载调试工具

2、[Air8000最新版本固件](https://docs.openluat.com/air8000/luatos/firmware/)（需确保固件版本≥V2015）

## 演示核心步骤

1、搭建好硬件环境，如果需要测试SD卡功能，需要选择开发板来测试。

2、通过Luatools将本工程代码与固件烧录到Air8000开发板中

3、烧录完成后，给设备上电，观察串口日志确认系统正常启动

```lua
系统启动，创建AP:
[000000000.434] I/user.main WIFI_AP_READ_FILE 001.000.000
[000000000.441] I/user.WIFI 创建AP热点: Air8000_FileHub
[000000000.496] I/user.执行AP创建操作 true 正常吗?

AP创建成功,开始挂载SD卡:
[000000000.511] I/user.SDCARD 开始初始化SD卡
[000000000.511] SPI_HWInit 552:spi1 speed 400000,400000,32
[000000000.512] I/user.sdcard_init open spi 0
[000000000.512] D/fatfs init sdcard at spi=1 cs=20
[000000000.678] D/SPI_TF 卡容量 15558144KB
[000000000.678] D/SPI_TF sdcard init OK OCR:0xc0ff8000!
[000000000.684] I/user.SDCARD 挂载SD卡结果: true
[000000000.685] I/user.fatfs 可用空间 {"free_sectors":31098752,"total_kb":15549952,"free_kb":15549376,"total_sectors":31099904}
[000000000.685] I/user.SDCARD SD卡初始化完成

SD卡挂载完毕，开始启动系统:
[000000002.632] I/httpsrv http listen at 192.168.4.1:80
[000000002.632] I/user.HTTP 文件服务器已启动
[000000002.632] I/user.HTTP 请连接WiFi: Air8000_FileHub，密码: 12345678
[000000002.633] I/user.HTTP 然后访问: http://192.168.4.1:80

```

4、在手机或电脑的WiFi设置中，搜索并连接名为`Air8000_FileHub`的热点，密码为`12345678`

5、连接成功后，打开浏览器，在地址栏输入`http://192.168.4.1`，进入文件管理系统登录页面

6、输入默认用户名`admin`和密码`123456`，点击登录

7、登录成功后，即可查看设备内部存储和SD卡中的文件列表

8、点击文件列表中文件名后的 **`下载`**，或在地址栏直接输入文件URL（如`http://192.168.4.1/456.txt`），即可下载文件到本地

9、如需要访问SD卡中的文件，点击网页左上角的 `TF/SD目录` ，即可切换到SD卡目录中，如需下载文件，点击文件名后的 **`下载`**，或在地址栏直接输入文件URL格式为`http://192.168.4.1/sd/文件名`（如`http://192.168.4.1/sd/readme.md`），即可下载文件到本地

## 系统参数说明

### AP参数

- SSID：Air8000_FileHub
- 密码：12345678
- 信道：6
- 最大连接数：4
- IP地址：192.168.4.1

### 认证参数

- 默认用户名：admin
- 默认密码：123456
- 会话超时：3600秒（1小时）

### HTTP服务器参数

- 端口：80
- 支持范围：文件浏览、文件下载
- 访问地址：http://192.168.4.1

## 注意事项

1、本示例默认使用内部存储路径`/luadb/`和SD卡路径`/sd/`，请确保文件确实存在于对应路径

2、使用SD卡时，请确保卡片格式为FAT32格式，实测最大容量支持1T

3、SD卡目录下文件夹名称不能为中文，否则会识别失败，无法下载文件夹中文件

4、下载大文件时，建议使用稳定的网络连接，避免下载中断

5、如需修改WiFi名称、密码或认证信息，请修改对应配置文件中的相关参数

6、如遇到无法连接WiFi热点或访问文件系统的情况，请检查设备电源和固件是否正常
