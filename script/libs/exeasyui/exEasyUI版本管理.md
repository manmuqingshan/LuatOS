# exEasyUI 版本管理

## 版本历史

### v1.0.0 - 初始版本 (SimpleUI)
**发布日期**: 2025年9月

**新增功能**:
- 基础UI框架设计
- 硬件解耦设计（LCD/TP独立初始化）
- 事件驱动架构
- 基础组件：Button、MessageBox
- MVC编程模式支持
- 触摸事件分发系统

**核心特性**:
- 组件化设计，统一 `draw/handleEvent` 接口
- 基于 `sys.publish/sys.subscribe` 的事件系统
- 支持硬件助手初始化或手动初始化
- 清晰的API设计，快速上手

---

### v1.1.0 - 扩展版本 (exSimpleUI)
**发布日期**: 2025年9月

**新增功能**:
- 库名更改为 `exSimpleUI`（扩展SimpleUI）
- 新增 CheckBox 复选框组件
- 新增 Icon 图标组件
- 引入 SimpleWindow 窗口容器概念
- 支持窗口背景图片设置
- 子组件管理功能

**删除功能**:
- 无

**改进功能**:
- 保持与v1.0的API兼容性
- 提供迁移建议和过渡支持
- 优化组件组织结构

---

### v1.2.0 - 字体系统扩展
**发布日期**: 2025年9月

**新增功能**:
- 统一字体适配层（FontAdapter）
- 支持三种字体后端：
  - 默认字体（内置位图字库）
  - 矢量字体（gtfont高通字体芯片）
  - 客户自定义bin字体（预留接口）
- 字体配置系统
- 文本测量和渲染优化
- 灰度字体渲染支持

**删除功能**:
- 无

**改进功能**:
- 组件文本渲染统一化
- 字体切换无感化
- 文本宽度测量准确性提升
- 支持多字号和字体样式

---

### v1.3.0 - 滑动窗口功能
**发布日期**: 2025年9月

**新增功能**:
- 窗口滑动支持（纵向/横向/双向）
- 惯性滑动效果
- 边界回弹效果
- 分页切换功能（横向桌面效果）
- 滚动条显示
- 拖拽阈值配置
- 分页吸附功能

**删除功能**:
- 无

**改进功能**:
- 触摸事件处理优化
- 点击与拖拽冲突处理
- 窗口容器功能增强
- 坐标变换系统

---

### v1.4.0 - 组件增强
**发布日期**: 2025年9月

**新增功能**:
- ToolButton 工具按钮组件（带图标的按键）
- Picture 图片组件（支持单图和轮播）
- 图片自动轮播功能
- 图片切换控制（播放/暂停/上一张/下一张）

**删除功能**:
- 无

**改进功能**:
- 组件功能更加丰富
- 图片显示能力增强
- 交互体验提升

---

### v1.5.0 - 稳定版本
**发布日期**: 2025年9月

**包含功能**:

#### 核心系统
- 硬件抽象层（hw模块）
- 组件管理系统（core模块）
- 事件分发系统（event模块）
- 主题支持（深色/浅色主题）

#### 组件库（8个组件）
1. **Button** - 基础按钮组件
   - 支持按下/抬起状态
   - 点击回调
   - 自定义颜色和文本

2. **ToolButton** - 工具按钮组件
   - 支持图标显示
   - 普通/按下/切换状态
   - 图片按钮功能

3. **CheckBox** - 复选框组件
   - 二态切换（选中/未选中）
   - 支持文本标签
   - 状态变化回调

4. **Label** - 标签组件
   - 文本显示
   - 自动尺寸计算
   - 字体样式支持

5. **Picture** - 图片组件
   - 单图显示
   - 多图轮播
   - 自动播放控制

6. **MessageBox** - 消息框组件
   - 标题和消息显示
   - 自定义按钮组
   - 模态对话框

7. **Window** - 窗口组件
   - 子组件管理
   - 子页面导航
   - 滚动支持
   - 背景设置

8. **ProgressBar** - 进度条组件
   - 百分比显示
   - 进度设置
   - 自定义文本

#### 高级功能
- **字体系统**: 支持默认字体、gtfont矢量字体
- **滑动窗口**: 支持纵向/横向滚动、惯性滑动、分页切换
- **主题系统**: 深色/浅色主题自动适配
- **事件系统**: 完整的触摸事件分发
- **硬件支持**: 支持多种LCD和触摸屏

#### 技术特性
- 单文件架构，便于集成
- 零依赖设计（仅依赖LuatOS基础模块）
- 内存占用优化
- 高性能渲染
- 完整的错误处理

---

### v1.6.0 - 当前版本
**发布日期**: 2025年10月7日

**更新概述**

1. **智能文本换行** - Label和MessageBox支持自动换行（`wordWrap`参数），英文按单词、中文按字符智能换行，高度自适应

2. **Button功能整合** - 合并ToolButton，统一支持文本/图片/Toggle三种模式（`src`/`toggle`参数），简化组件体系

3. **Windows 11风格配色** - Light/Dark双主题默认配色，Window/Button自动应用现代化视觉效果，提供6个新颜色常量

4. **代码质量提升** - UTF-8字符正确处理、向后兼容、删除冗余组件、所有示例添加版本标识

**新增功能**:
- Label组件支持自动换行
  - 新增 `wordWrap` 参数控制是否启用换行
  - 支持指定最大宽度 `w`，超出部分截断或换行
  - 换行时高度自动调整以容纳所有文本行
  - **智能换行**：英文按单词换行，中文按字符换行
- MessageBox组件支持自动换行
  - 新增 `wordWrap` 参数控制是否启用换行
  - 在固定高度内自动分行显示，超出部分截断
  - **智能换行**：英文按单词换行，中文按字符换行
- Button组件合并ToolButton功能
  - 新增图片按钮支持：`src`、`src_pressed`、`src_toggled` 参数
  - 新增Toggle模式：`toggle`、`toggled`、`onToggle` 参数
  - 图片显示优先于文本显示
- 所有示例代码添加版本标识注释
- **Windows 11 风格配色**（Light + Dark模式）
  - Light模式：
    - `COLOR_WIN11_LIGHT_DIALOG_BG`：RGB(243, 243, 243) - 对话框背景色
    - `COLOR_WIN11_LIGHT_BUTTON_BG`：RGB(251, 251, 252) - 按钮背景色
    - `COLOR_WIN11_LIGHT_BUTTON_BORDER`：RGB(229, 229, 229) - 按钮边框色
  - Dark模式：
    - `COLOR_WIN11_DARK_DIALOG_BG`：RGB(32, 32, 32) - 对话框背景色
    - `COLOR_WIN11_DARK_BUTTON_BG`：RGB(51, 51, 51) - 按钮背景色
    - `COLOR_WIN11_DARK_BUTTON_BORDER`：RGB(76, 76, 76) - 按钮边框色

**删除功能**:
- 移除 ToolButton 组件（功能已合并到Button）
- 删除 ToolButton 相关示例代码

**改进功能**:
- 文本处理能力增强，支持长文本自动换行
- 组件体系简化，减少代码冗余
- 按钮组件功能更加完整和统一
- **Windows 11 风格默认配色改进**（Light + Dark）
  - Light模式（浅色主题）：
    - Window 默认背景色：RGB(243, 243, 243)
    - Button 默认背景色：RGB(251, 251, 252)
    - Button 默认边框色：RGB(229, 229, 229)
  - Dark模式（深色主题）：
    - Window 默认背景色：RGB(32, 32, 32)
    - Button 默认背景色：RGB(51, 51, 51)
    - Button 默认边框色：RGB(76, 76, 76)
  - 整体视觉效果更加现代化，与 Windows 11 UI 风格完全一致

**技术改进**:
- UTF-8字符正确处理，按完整字符边界换行
- 文本宽度测量和换行算法优化
- RGB565颜色精确转换，保证色彩准确度
- 主题适配增强，深色/浅色模式自动切换合适配色
- 保持向后兼容性，现有代码无需修改

---

### v1.6.1 - 稳定性修复版
**发布日期**: 2025年10月9日

**更新概述**  
1. **交互体验提升** - 按钮防移出机制修复，滚动和非滚动窗口下按钮交互更自然，避免误触和颜色异常。  
2. **MessageBox复用与易用性增强** - MessageBox新增了动态显示/隐藏和内容更新的子方法，默认自动换行。
3. **图片加载与占位符优化** - 新增图片占位符样式，图片加载失败有清晰提示，I/O检查更高效，开发调试体验提升。

**修复问题**:
1. **按钮防移出机制修复**
   - 修复滚动Window中按钮移出范围后颜色异常
   - 修复非滚动Window中缺少_capture检查的问题
   - 在Window滚动观望期转发MOVE事件给已捕获的子组件
   - 添加_capture检查让已捕获组件能收到移出范围的MOVE事件

2. **MessageBox复用功能完善**
   - 修复点击按钮后enabled被禁用导致无法复用的问题
   - 新增`show()`方法：显示MessageBox
   - 新增`hide()`方法：隐藏MessageBox
   - 新增`setTitle(title)`方法：动态更新标题
   - 新增`setMessage(message)`方法：动态更新消息内容
   - 修复无按钮MessageBox文本区域被挤占的问题（增加约38px可用空间）
   - 修复visible参数不生效的问题，支持从opts读取
   - 修复wordWrap默认关闭的问题，现在默认启用自动换行

3. **图片占位符优化**
   - 新增`draw_image_placeholder()`函数绘制改进的占位符
   - 占位符样式：灰色背景+白色边框+双层X叉（尺寸≥20px时）
   - 添加文件存在性检查（io.exists）
   - 添加图片加载状态缓存（_imageCache），每个路径只检查一次
   - 文件不存在时输出警告日志（每个路径只警告一次）
   - Button和Picture组件统一使用新的占位符样式
   - 性能优化：避免每帧重复I/O检查（从每秒33次降为1次）

**改进功能**:
- MessageBox自动换行默认开启，无需显式传入wordWrap=true
- 图片加载失败时提供清晰的视觉反馈和日志提示
- 优化开发调试体验，快速定位图片路径问题

**示例更新**:
- 更新`msgbox/main.lua`示例，展示MessageBox复用功能
- 添加1秒循环任务演示动态更新时间
- 更新`msgbox_page.lua`示例，使用新的复用API

**技术改进**:
- 事件分发机制优化，修复Window事件转发逻辑
- 缓存机制优化，减少不必要的文件I/O操作
- 代码注释增强，添加v1.6.1修复标记

**兼容性**:
- ✅ 保持向后兼容，现有代码无需修改
- ✅ 新增API不影响现有功能
- ⚠️ MessageBox自动换行默认开启，如需关闭请显式传入wordWrap=false

**使用建议**:
- Picture组件建议使用正方形或接近正方形的尺寸（如120x120、160x160等）
- MessageBox推荐使用复用模式：创建时设置visible=false，使用时调用show()

---

## 版本规划

### v1.7.0 - 计划中
**预计功能**:
- 更多基础组件（Input输入框、List列表等）
- 布局系统
- 动画支持
- 性能优化

### v2.0.0 - 长期规划
**预计功能**:
- 完整的UI框架
- 更多高级组件
- 主题定制系统
- 国际化支持
- 开发工具支持

---

## 使用建议

- **新项目**: 建议使用最新版本v1.6.1
- **现有项目**: 建议升级到v1.6.1以获得稳定性修复
- **功能选择**: 根据项目需求选择合适的组件和功能
- **性能考虑**: 在资源受限的设备上建议关闭不必要的功能

---

## 更新日志格式

每个版本更新时，请按照以下格式记录：

```markdown
### vX.X.X - 版本名称
**发布日期**: YYYY年MM月

**新增功能**:
- 功能描述

**删除功能**:
- 功能描述

**改进功能**:
- 功能描述

**修复问题**:
- 问题描述
```
